
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>Shaker App Example</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Shaker</span></a></h1>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="index.html" title="Shaker">Shaker</a>
        &#160;&#160;::&#160;&#160;
        
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="shaker-app-example">
<h1>Shaker App Example<a class="headerlink" href="#shaker-app-example" title="Permalink to this headline">¶</a></h1>
<p>To better understand how Shaker works, we are going to create simple application from scratch,
which will cover the basic features and some advanced configuration as well.</p>
<div class="section" id="application-overview">
<h2>Application overview<a class="headerlink" href="#application-overview" title="Permalink to this headline">¶</a></h2>
<img alt="_images/example_app.png" class="align-right" src="_images/example_app.png" style="width: 700px;" />
<p>Our application will have three main mojits:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">master</span></tt> - The &#8220;parent mojit&#8221;, which will be the placeholder for the other mojits</li>
<li><tt class="docutils literal"><span class="pre">primary</span></tt> - Will contain the left part of our application.</li>
<li><tt class="docutils literal"><span class="pre">secondary</span></tt> - Will be the the right part of our application.</li>
</ul>
<p>Each mojit will react to a specific set of dimensions:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">device</span></tt>: default, smartphone</li>
<li><tt class="docutils literal"><span class="pre">region</span></tt>:  default, CA</li>
<li><tt class="docutils literal"><span class="pre">skin</span></tt>: default, gray, blue</li>
</ul>
<p>Thus, if we are on a mobile device, we might load different CSS. Similarly, we may load different assets according to skin and/or region. Shaker will handle all the possible combinations.</p>
</div>
<div class="section" id="application-structure">
<h2>Application structure<a class="headerlink" href="#application-structure" title="Permalink to this headline">¶</a></h2>
<p>In this section we will analyze in detail every piece of our application.</p>
<div class="section" id="master-mojit">
<h3>master mojit<a class="headerlink" href="#master-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the placeholder for the other two mojits. Let&#8217;s take a look at the controller and the view:</p>
<p><strong>controller.common.js:</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">primary</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;index&#39;</span>
            <span class="p">},</span>
            <span class="nx">secondary</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;secondary&#39;</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;index&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">ac</span><span class="p">.</span><span class="nx">composite</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">},</span>

<span class="nx">dynamic</span><span class="o">:</span><span class="p">{</span>
    <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s1">&#39;AJAX entry point!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, we are not manually including any CSS and we don&#8217;t have any logic at all in our controller. Shaker takes care of this at runtime based on the current context. Note that we have another controller action which will be used by the binder (explained in the next paragraph).</p>
<p><strong>index.mu.html:</strong></p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;doc&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;head&quot;</span> <span class="na">class=</span><span class="s">&quot;clearfix&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span> <span class="na">class=</span><span class="s">&quot;clearfix&quot;</span><span class="nt">&gt;</span>
    {{{primary}}}
    {{{secondary}}}
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Also <tt class="docutils literal"><span class="pre">master</span></tt> will react to various dimensions (skin:grey, device:smartphone), so this is how the asset structure looks:</p>
<div class="highlight-text"><div class="highlight"><pre>master/
   /assets/
      /common/
<span class="hll">         master.css
</span>      /device/
         /smartphone/
<span class="hll">            master-smartphone.css
</span>      /skin/
         /grey/
<span class="hll">            master-grey.css
</span>         /blue/
<span class="hll">            blue.css
</span></pre></div>
</div>
<p>Note that there is a special dimension called <tt class="docutils literal"><span class="pre">common</span></tt> which basically acts as a css-base, sharing all its css among all other
dimensions. The <tt class="docutils literal"><span class="pre">master-smartphone.css</span></tt> or <tt class="docutils literal"><span class="pre">master-grey.css</span></tt> files will have some style overrides to change the baseplate style.</p>
</div>
<div class="section" id="primary-mojit">
<h3>primary mojit<a class="headerlink" href="#primary-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the left part of our application (you can see it in the picture above). We are not going to show neither controller or view since they don&#8217;t contain anything really special more than the HTML template and some dummy data to populate it. What is important to shaker is which assets our Mojit contains. In this case, the mojit is sensitive to <tt class="docutils literal"><span class="pre">region</span></tt> and <tt class="docutils literal"><span class="pre">skin</span></tt>:</p>
<p><strong>Assets structure</strong></p>
<div class="highlight-text"><div class="highlight"><pre>primary/
   /assets/
      /common/
<span class="hll">         primary.css
</span>      /region/
         /CA/
<span class="hll">            primary-CA.css
</span>      /skin/
         /grey/
<span class="hll">            primary-grey.css
</span>         /blue/
<span class="hll">            blue.css
</span></pre></div>
</div>
<p>Note: the name of the files doesn&#8217;t matter. Only the folder structure is important.</p>
<p>This mojit will contain a binder which will be deployed to the client to further communication using a different entry point.</p>
<p><strong>Binder: index.js</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;#call&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_executeInvoke</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
<span class="p">},</span>

<span class="nx">_executeInvoke</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mojitProxy</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;dynamic&#39;</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resultInvoke</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
<span class="p">},</span>

<span class="nx">resultInvoke</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Note that no request have been made at this point.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We are including this binder so you can see how Shaker is doing the rollups with all the client side dependencies (if <tt class="docutils literal"><span class="pre">deploy</span></tt> is set to <tt class="docutils literal"><span class="pre">true</span></tt>)</p>
</div>
<div class="section" id="secondary-mojit">
<h3>secondary mojit<a class="headerlink" href="#secondary-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the right part of our application. This mojit reacts to all the previous dimensions:</p>
<div class="highlight-text"><div class="highlight"><pre>secondary/
   /assets/
      /common/
<span class="hll">         secondary.css
</span>      /device/
         /smartphone/
<span class="hll">            secondary-smartphone.css
</span>      /region/
         /CA/
<span class="hll">           secondary-CA.css
</span>      /skin/
         /grey/
<span class="hll">            secondary-grey.css
</span>         /blue/
<span class="hll">            some-blue.css
</span></pre></div>
</div>
<p>Note: the name of the files doesn&#8217;t matter. Only the folder structure is important.</p>
</div>
<div class="section" id="htmlframe-mojit">
<h3>HTMLFrame mojit<a class="headerlink" href="#htmlframe-mojit" title="Permalink to this headline">¶</a></h3>
<p>Mojito uses an &#8220;HTMLFrame&#8221; to create the skeleton of the HTML document and to embed all your executed mojits ( See <a class="reference external" href="http://developer.yahoo.com/cocktails/mojito/docs/code_exs/htmlframe_view.html">Using HTML Frame Mojit</a>) Shaker will need to be executed within this HTMLFrame, so basically we create a copy of the original HTMLFrame and add the little pieces we need:</p>
<p><strong>ShakerHTMLFrame controller.server.js</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">...</span>
 <span class="nx">__call</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
   <span class="c1">// If we are deploying to the client get all the assets required</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">ac</span><span class="p">.</span><span class="nx">deploy</span><span class="p">.</span><span class="nx">constructMojitoClientRuntime</span><span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">assets</span><span class="p">,</span>
                      <span class="nx">meta</span><span class="p">.</span><span class="nx">binders</span><span class="p">);</span>
              <span class="p">}</span>
<span class="hll">              <span class="nx">ac</span><span class="p">.</span><span class="nx">shaker</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>
</span>
              <span class="c1">// Attach assets found in the &quot;meta&quot; to the page</span>
              <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">assets</span><span class="p">.</span><span class="nx">getAssets</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">types</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
              <span class="p">...</span>
      <span class="p">}</span>
      <span class="p">...</span>

 <span class="p">},</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;mojito-assets-addon&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mojito-deploy-addon&#39;</span><span class="p">,</span>
<span class="hll">  <span class="s1">&#39;mojito-config-addon&#39;</span><span class="p">,</span>
</span>  <span class="s1">&#39;mojito-shaker-addon&#39;</span>
<span class="p">]});</span>
</pre></div>
</div>
<p>We need shaker to execute after analyzing all the dependencies if the application is deployed to the client, and before the assets get passed to the markup.</p>
</div>
<div class="section" id="application-configuration">
<h3>Application configuration<a class="headerlink" href="#application-configuration" title="Permalink to this headline">¶</a></h3>
<p>We need to tell shaker how we want to do the rollups. In order to do that we have to create in <tt class="docutils literal"><span class="pre">aplication.json</span></tt> a shaker object with the correct configuration.</p>
<p><strong>Example of usage of ``shaker`` in application.json</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">[{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;//&quot;</span><span class="o">:</span> <span class="s2">&quot;we set out ShakerHTMLFrame as main mojit&quot;</span>
    <span class="s2">&quot;//&quot;</span><span class="o">:</span> <span class="k">this</span> <span class="nx">configuration</span> <span class="nx">is</span> <span class="nx">shared</span> <span class="nx">to</span> <span class="nx">all</span> <span class="nx">context</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;htmlframe&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;ShakerHTMLFrameMojit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;deploy&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Shaker Demo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;child&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;master&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;environment:test&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;shaker&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="o">:</span> <span class="s2">&quot;local&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;environment:stage&quot;</span><span class="p">],</span>
</span>
    <span class="s2">&quot;shaker&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="o">:</span> <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;parallel&quot;</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;delay&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;myAmazonKey&quot;</span><span class="p">,</span>
                <span class="s2">&quot;secret&quot;</span><span class="o">:</span> <span class="s2">&quot;myAmazonSecret&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bucket&quot;</span><span class="o">:</span> <span class="s2">&quot;shaker&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>We define a different configuration for every environment. For example in the basic one <tt class="docutils literal"><span class="pre">[&quot;master&quot;]</span></tt> we don&#8217;t have any configuration, so shaker is going to assume that we are in &#8220;developer mode&#8221; which means Shaker won&#8217;t do any rollups at all, It just going to include the files one by one. On the other hand, if we are in <tt class="docutils literal"><span class="pre">[stage]</span></tt> Shaker will do the rollups and upload them to the Amazon CDN (see <a class="reference external" href="shaker_usage.html#environment-configuration">Deployment Configuration</a>  for more information).
In the next section we will see exactly what gets deployed for every particular case.</p>
</div>
</div>
<div class="section" id="shaker-running-on-our-app">
<h2>Shaker running on our App<a class="headerlink" href="#shaker-running-on-our-app" title="Permalink to this headline">¶</a></h2>
<p>Now that we understand the internals of our application, let&#8217;s see how it behaves at build time and at runtime.</p>
<div class="section" id="build-time">
<h3>Build time<a class="headerlink" href="#build-time" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>To run shaker, execute the shaker command:</dt>
<dd><tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">shake</span></tt></dd>
<dt>Shaker accepts the following commands:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">--context</span></tt> - Specify the context environment which Shaker will pick up</li>
<li><tt class="docutils literal"><span class="pre">--run</span></tt> - After execute shaker, it will run the server (exactly as <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">start</span></tt>)</li>
</ul>
</dd>
</dl>
<p>If you don&#8217;t specify a context, shaker will run picking the default configuration (<tt class="docutils literal"><span class="pre">[master]</span></tt>).</p>
<p>Let&#8217;s assume that we run <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">shake</span> <span class="pre">--context</span> <span class="pre">&quot;environment:test&quot;</span> <span class="pre">--run</span></tt>. This will make Shaker generate local rollups and then start the server. Shaker will take the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>It will analyze all your application files, looking for Mojits and within mojits all autoloads, assets, binders, views...</li>
<li>It will compute all the dependencies for binders, all the dimensions for assets and generate metadata information,</li>
<li>It will take the previous metadata, concatenate, minify, and write the rollups either to local or to the cdn.</li>
<li>It will write the metadata file as a compiled autoload, which will contain all the generated rollup paths. This file will be picked automatically on runtime.</li>
</ol>
</div></blockquote>
<p>Everything spin around this metadata file. Let&#8217;s see how this file looks like for our app:</p>
<p><strong>Example: shaker-meta.common.js</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;shaker/metaMojits&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;_mojito._cache.shaker&quot;</span><span class="p">);</span>
<span class="hll"><span class="nx">YUI</span><span class="p">.</span><span class="nx">_mojito</span><span class="p">.</span><span class="nx">_cache</span><span class="p">.</span><span class="nx">shaker</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span>
</span><span class="p">{</span>
  <span class="s2">&quot;mojits&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="hll">    <span class="s2">&quot;master&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="p">{</span>
</span>        <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_default_c75fe0cbaaf623aea7be93e50b7f3c7f.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;common-*-smartphone-grey&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_default_c7073a85504c3e292c97c059222cc051.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;common-*-device-grey-region-lang&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_default_b347e1cf67ee4b5520442825ce61f26c.css&quot;</span><span class="p">],</span>
          <span class="p">...</span>
        <span class="p">},</span>
        <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_89d0110765d6c92d517b3bab39407c9a.client.js&quot;</span><span class="p">],</span>
        <span class="s2">&quot;meta&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
<span class="hll">    <span class="s2">&quot;primary&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">{</span>
</span>        <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_index_9eee7d6bfbc2d41a0d57ae90ff40f61a.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;common-index-device-grey-CA-lang&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_index_e1100f2ae51bde147e1dad91b3be2b70.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;common-index-device-grey-region-lang&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_index_1566cfc15fd5fc2b6add48f6d33291db.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;common-index-device-skin-CA-lang&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_index_04cb930f6f9e7f1af6879d96dd2f82ee.css&quot;</span><span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span>
          <span class="s2">&quot;/static/demo/assets/compiled/primary_d3d36e4c5173cb91aae507cf5ecb2ef8.client.js&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;meta&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;models&quot;</span><span class="o">:</span> <span class="p">[],</span>
            <span class="s2">&quot;controllers&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/path/to/app/demo/mojits/primary/controller.common.js&quot;</span><span class="p">],</span>
            <span class="s2">&quot;binders&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/path/to/app/demo/mojits/primary/binders/index.js&quot;</span><span class="p">],</span>
            <span class="s2">&quot;views&quot;</span><span class="o">:</span> <span class="p">[</span>
              <span class="s2">&quot;/path/to/app/demo/mojits/primary/views/dynamic.mu.html&quot;</span><span class="p">,</span>
              <span class="s2">&quot;/path/to/app/demo/mojits/primary/views/index.mu.html&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">[]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
<span class="hll">    <span class="s2">&quot;secondary&quot;</span><span class="o">:</span> <span class="p">{</span>
</span>      <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/secondary_default_d139d9b8eb6d55219f3ee0f9fdabd7e2.css&quot;</span>
          <span class="p">...</span>
  <span class="s2">&quot;core&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;/static/demo/assets/compiled/core_54287af0374120fd75a3d7251d66eb90.common.js&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">...</span>
  <span class="p">],</span>
  <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}});</span>
</pre></div>
</div>
<p>As you can see for each mojit and for each possible combination, Shaker generated a rollup. Shaker signs the rollup with MD5 to avoid committing the same file twice. Moreover, Shaker generates the Mojito core rollup for you and also all the client side rollup (if your app is set to deploy:true).</p>
<p>During development, you may want to know what exactly gets included in every rollup. To do that, just run shaker in dev mode: <tt class="docutils literal"><span class="pre">mojit</span> <span class="pre">shake</span></tt></p>
<p><strong>Developer context shaker-meta.common.js</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;shaker/metaMojits&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;_mojito._cache.shaker&quot;</span><span class="p">);</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">_mojito</span><span class="p">.</span><span class="nx">_cache</span><span class="p">.</span><span class="nx">shaker</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="s2">&quot;mojits&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;master&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/master/assets/common/master.css&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;common-*-smartphone&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/master/assets/common/master.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/device/smartphone/master-smartphone.css&quot;</span>
                    <span class="s2">&quot;common-*-smartphone-grey&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/master/assets/common/master.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/device/smartphone/master-smartphone.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/skin/grey/master-grey.css&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;common-*-smartphone-skin&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/master/assets/common/master.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/device/smartphone/master-smartphone.css&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;common-*-smartphone-grey-region-lang&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/master/assets/common/master.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/device/smartphone/master-smartphone.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/master/assets/skin/grey/master-grey.css&quot;</span>
                    <span class="p">],</span>
                    <span class="p">...</span>
                <span class="p">},</span>
                <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/master/controller.common.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/master/views/index.mu.html&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;meta&quot;</span><span class="o">:</span> <span class="p">{</span>
                   <span class="p">...</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;primary&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/primary/assets/common/primary.css&quot;</span>
                    <span class="p">],</span>
                    <span class="p">...</span>
                    <span class="s2">&quot;common-index-device-grey-CA&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/primary/assets/common/primary.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/primary/assets/skin/grey/primary-grey.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/primary/assets/region/CA/primary-CA.css&quot;</span>
                    <span class="p">],</span>

                    <span class="s2">&quot;common-index-device-skin-CA-lang&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/primary/assets/common/primary.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/primary/assets/region/CA/primary-CA.css&quot;</span>
                    <span class="p">],</span>
                    <span class="p">...</span>
                <span class="p">},</span>
                <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/primary/controller.common.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/primary/binders/index.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/primary/views/dynamic.mu.html&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/primary/views/index.mu.html&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;meta&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;secondary&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;shaken&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;common&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/secondary/assets/common/secondary.css&quot;</span>
                    <span class="p">],</span>
                    <span class="p">...</span>
                    <span class="s2">&quot;common-index-smartphone-grey-region&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/secondary/assets/common/secondary.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/secondary/assets/device/smartphone/secondary-smartphone.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/secondary/assets/skin/grey/secondary-grey.css&quot;</span>
                   <span class="p">],</span>
                   <span class="p">...</span>
                    <span class="s2">&quot;common-index-device-skin-CA-lang&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/secondary/assets/common/secondary.css&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/static/secondary/assets/region/CA/secondary-CA.css&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;common-index-device-skin-region-lang&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s2">&quot;/static/secondary/assets/common/secondary.css&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">[</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/secondary/controller.common.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/secondary/binders/index.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;/path/to/app/demo/mojits/secondary/views/index.mu.html&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;meta&quot;</span><span class="o">:</span> <span class="p">{</span>
                   <span class="p">...</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="s2">&quot;core&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;/Users/diegof/node_modules/mojito/lib/app/addons/ac/analytics.common.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/Users/diegof/node_modules/mojito/lib/app/addons/ac/assets.common.js&quot;</span><span class="p">,</span>
        <span class="p">...</span>
        <span class="s2">&quot;/Users/diegof/node_modules/mojito/lib/app/autoload/view-renderer.common.js&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;/path/to/app/demo/assets/favicon.ico&quot;</span><span class="p">,</span>
        <span class="p">...</span>
    <span class="p">],</span>
    <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}});</span>
</pre></div>
</div>
<p>You can see which files will be picked up for each dimension combination, and also which files will be picked up on the client side.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, every mojit will require two requests, one for the CSS rollup, and another for all the JS. You could improve the number of requests by bundling mojits together. It&#8217;s what we call &#8220;High coverage mojits&#8221;. In order to do that, you will have to create a <tt class="docutils literal"><span class="pre">shaker.json</span></tt> configuration file at the application level. For more information, read the Advanced Configuration.</p>
</div>
</div>
<div class="section" id="runtime">
<h3>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h3>
<p>At runtime, the normal workflow happens in mojito until the execution reach the ShakerHTMLFrame. THen our Shaker addon gets executed, looks at the context, determines which dimensions match the request, and serves the most appropriate rollup to the client. So if the context of a request is set to <tt class="docutils literal"><span class="pre">region:CA</span></tt> and <tt class="docutils literal"><span class="pre">device:smartphone</span></tt>, Shaker will pick the rollup for those dimensions and attach it to the page.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To create custom dimensions (not built in mojit) you will have to set the value of that dimension at runtime. In this example, &#8220;skin&#8221; is picked from the url and passed to the context so Shaker can know which value to pick up.</p>
</div>
<p>Shaker also allows you to bundle css rollups at the application level. In this example we have some boilerplate css which belongs to the application level and gets shared among all mojits.</p>
</div>
</div>
</div>

   </div>
