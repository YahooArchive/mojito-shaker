YUI.add("mojito-output-handler",function(Y,NAME){var attachAssets,complete,loaded={js:{},css:{}};attachAssets=function(assets,cb){var toLoad={css:[],js:[]},done={},blobNode="",doneChecker;Y.Object.each(assets,function(types,location){Y.Object.each(types,function(list,type){var i;if(type==="blob"){for(i=0;i<list.length;i+=1){blobNode+=list[i]}}else{for(i=0;i<list.length;i+=1){if(!loaded[type][list[i]]){toLoad[type].push(list[i])}loaded[type][list[i]]=true}}})});if(blobNode){Y.one("head").append(blobNode)}doneChecker=function(type){if(type){done[type]=true}if(done.css&&done.js){cb()}};if(toLoad.css.length>0){Y.Get.css(toLoad.css,{onEnd:function(){doneChecker("css")}})}else{done.css=true}if(toLoad.js.length>0){Y.Get.script(toLoad.js,{onEnd:function(){doneChecker("js")}})}else{done.js=true}doneChecker()};complete=function(data,meta,client,viewId,callback){if(meta&&meta.http&&meta.http.headers["content-type"]&&meta.http.headers["content-type"][0].indexOf("application/json")===0){data=Y.JSON.parse(data)}callback(null,data,meta);if(meta&&meta.binders){window.setTimeout(function(){client.attachBinders(meta.binders,viewId,meta.view.id)})}};function OutputHandler(viewId,cb,mojitoClient){this.viewId=viewId;this.callback=cb;this.buffer="";this.mojitoClient=mojitoClient;this.page=mojitoClient.page}OutputHandler.prototype={flush:function(data,meta){this.done(data,meta)},done:function(data,meta){var client=this.mojitoClient,viewId=this.viewId,callback=this.callback;if(meta&&meta.assets){attachAssets(meta.assets,function(){complete(data,meta,client,viewId,callback)})}else{complete(data,meta,client,viewId,callback)}},error:function(err){this.callback(err)}};Y.namespace("mojito").OutputHandler=OutputHandler},"0.1.0",{requires:["mojito","json-parse","node"]});
