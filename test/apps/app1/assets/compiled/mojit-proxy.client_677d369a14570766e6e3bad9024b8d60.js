YUI.add("mojito-mojit-proxy",function(Y,NAME){var MJT_EVT_PRFX="mojit:";function MojitProxy(opts){this._action=opts.action;this._binder=opts.binder;this._base=opts.base;this._node=opts.node;this._element=opts.element;this._viewId=opts.viewId;this._instanceId=opts.instanceId;this._client=opts.client;this._store=opts.store;this.type=opts.type;this.config=opts.config;this.context=opts.context}MojitProxy.prototype={broadcast:function(name,payload,options){this._client.doBroadcast(MJT_EVT_PRFX+name,this._viewId,payload,options)},listen:function(name,callback){this._client.doListen(MJT_EVT_PRFX+name,this._viewId,function(evt){if(evt.source!==this.id){callback(evt)}})},unlisten:function(name){var eventName=name?MJT_EVT_PRFX+name:null;this._client.doUnlisten(this._viewId,eventName)},render:function(data,view,cb){this._client.doRender(this,data,view,cb)},invoke:function(action,options,cb){var callback,command,instance;options=options||{};if("function"===typeof options){callback=options;options={}}else{callback=cb}if("function"!==typeof callback){callback=function(){}}options.params=options.params||{};instance={base:this._base,type:this.type,instanceId:this._instanceId,config:Y.mojito.util.copy(this.config)};command={instance:instance,action:action,params:{route:options.params.route||{},url:options.params.url||this.getFromUrl(),body:options.params.body||{},file:options.params.file||{}},rpc:options.rpc||false};this._client.executeAction(command,this.getId(),callback)},refreshView:function(opts,cb){opts=opts||{};if(Y.Lang.isFunction(opts)){cb=opts;opts={}}this._client.refreshMojitView(this,opts,cb)},getFromUrl:function(key){if(!this.query){this.query=Y.QueryString.parse(window.location.href.split("?").pop())}if(key){return this.query[key]}return this.query},getId:function(){return this._viewId},getChildren:function(){return this._client._mojits[this.getId()].children},destroyChild:function(id,retainNode){var slot,doomed,children=this.getChildren(),child=children[id];if(child){doomed=child.viewId}else{for(slot in children){if(children.hasOwnProperty(slot)&&children[slot].viewId===id){doomed=id;break}}}if(!doomed){throw new Error("Cannot destroy a child mojit with id '"+id+"'. Are you sure this is your child?")}this._client.destroyMojitProxy(doomed,retainNode);if(child){if(this.config.children){this.config.children[id]=undefined}children[id]=undefined}},destroyChildren:function(retainNode){var children=this.getChildren(),child;for(child in children){if(children.hasOwnProperty(child)){this.destroyChild(child,retainNode)}}},destroySelf:function(retainNode){this._client.destroyMojitProxy(this.getId(),retainNode)},_destroy:function(retainNode){var binder=this._binder;Y.log("destroying binder "+this._viewId,"debug",NAME);this.destroyChildren(retainNode);if(Y.Lang.isFunction(binder.destroy)){binder.destroy.call(binder)}if(!retainNode){this._node.remove(true)}this._client.doUnlisten(this._viewId)},_pause:function(){var binder=this._binder;if(Y.Lang.isFunction(binder.onPause)){binder.onPause()}},_resume:function(){var binder=this._binder;if(Y.Lang.isFunction(binder.onResume)){binder.onResume()}}};Y.namespace("mojito").MojitProxy=MojitProxy},"0.1.0",{requires:["mojito","mojito-util","querystring"]});
